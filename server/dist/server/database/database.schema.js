/// <reference path="../../../typings/index.d.ts" />
"use strict";
var mongoose = require('mongoose');
var bcrypt = require('bcrypt');
var SALT_WORK_FACTOR = 10;
exports.GameStatsSchema = new mongoose.Schema({
    Won: { type: Number, required: true },
    Played: { type: Number, required: true },
    badges: { type: [String], required: false }
});
exports.ItemStatListSchema = new mongoose.Schema({
    Speed: { type: Number, required: true },
    Acceleration: { type: Number, required: true },
    ShieldProtection: { type: Number, required: true },
    ShieldRechargeRate: { type: Number, required: true },
    GunDamage: { type: Number, required: true },
    FireRate: { type: Number, required: true }
});
exports.UnlockedItemSchema = new mongoose.Schema({
    Name: { type: String, required: true },
    Stats: { type: exports.ItemStatListSchema, required: true },
    FilePath: { type: String, required: true },
    Description: { type: String, required: true }
});
exports.UnlockablesSchema = new mongoose.Schema({
    Bikes: { type: [exports.UnlockedItemSchema], required: false },
    Textures: { type: [exports.UnlockedItemSchema], required: false },
    Guns: { type: [exports.UnlockedItemSchema], required: false }
});
exports.UserSchema = new mongoose.Schema({
    CreatedAt: { type: String, 'default': Date.now },
    UpdatedAt: { type: String, 'default': Date.now },
    UserName: { type: String, required: true, index: { unique: true } },
    Password: { type: String, required: true },
    Email: { type: String, required: true },
    GameStats: { type: exports.GameStatsSchema, required: true },
    Unlockables: { type: exports.UnlockablesSchema, required: true }
});
exports.UserSchema.pre('save', function (next) {
    var user = this;
    // only hash the password if it has been modified (or is new)
    if (!user.isModified('Password'))
        return next();
    // generate a salt
    bcrypt.genSalt(SALT_WORK_FACTOR, function (err, salt) {
        if (err)
            return next(err);
        // hash the password using our new salt
        bcrypt.hash(user.Password, salt, function (err, hash) {
            if (err)
                return next(err);
            // override the cleartext password with the hashed one
            user.Password = hash;
            next();
        });
    });
});
exports.UserSchema.methods.comparePassword = function (candidatePassword, cb) {
    bcrypt.compare(candidatePassword, this.Password, function (err, isMatch) {
        if (err)
            return cb(err);
        cb(null, isMatch);
    });
};
exports.GameStats = mongoose.model('GameStats', exports.GameStatsSchema);
exports.ItemStatList = mongoose.model('ItemStatList', exports.ItemStatListSchema);
exports.UnlockedItem = mongoose.model('UnlockedItem', exports.UnlockedItemSchema);
exports.Unlockables = mongoose.model('Unlockables', exports.UnlockablesSchema);
exports.User = mongoose.model('User', exports.UserSchema);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlci9kYXRhYmFzZS9kYXRhYmFzZS5zY2hlbWEudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsb0RBQW9EOztBQUdwRCxJQUFZLFFBQVEsV0FBTSxVQUFVLENBQUMsQ0FBQTtBQUVyQyxJQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDakMsSUFBTSxnQkFBZ0IsR0FBRyxFQUFFLENBQUM7QUFNZix1QkFBZSxHQUFHLElBQUksUUFBUSxDQUFDLE1BQU0sQ0FBQztJQUMvQyxHQUFHLEVBQUcsRUFBQyxJQUFJLEVBQUcsTUFBTSxFQUFFLFFBQVEsRUFBRyxJQUFJLEVBQUM7SUFDdEMsTUFBTSxFQUFHLEVBQUMsSUFBSSxFQUFHLE1BQU0sRUFBRSxRQUFRLEVBQUcsSUFBSSxFQUFDO0lBQ3pDLE1BQU0sRUFBRyxFQUFDLElBQUksRUFBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRyxLQUFLLEVBQUM7Q0FDL0MsQ0FBQyxDQUFDO0FBRVUsMEJBQWtCLEdBQUcsSUFBSSxRQUFRLENBQUMsTUFBTSxDQUFDO0lBQ2xELEtBQUssRUFBRSxFQUFDLElBQUksRUFBRyxNQUFNLEVBQUUsUUFBUSxFQUFHLElBQUksRUFBQztJQUN2QyxZQUFZLEVBQUUsRUFBQyxJQUFJLEVBQUcsTUFBTSxFQUFFLFFBQVEsRUFBRyxJQUFJLEVBQUM7SUFDOUMsZ0JBQWdCLEVBQUcsRUFBQyxJQUFJLEVBQUcsTUFBTSxFQUFFLFFBQVEsRUFBRyxJQUFJLEVBQUM7SUFDbkQsa0JBQWtCLEVBQUcsRUFBQyxJQUFJLEVBQUcsTUFBTSxFQUFFLFFBQVEsRUFBRyxJQUFJLEVBQUM7SUFDckQsU0FBUyxFQUFHLEVBQUMsSUFBSSxFQUFHLE1BQU0sRUFBRSxRQUFRLEVBQUcsSUFBSSxFQUFDO0lBQzVDLFFBQVEsRUFBRyxFQUFDLElBQUksRUFBRyxNQUFNLEVBQUUsUUFBUSxFQUFHLElBQUksRUFBQztDQUM5QyxDQUFDLENBQUM7QUFFVSwwQkFB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TSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLFVBQVMsR0FBRyxFQUFFLE9BQU87UUFDbEUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN4QixFQUFFLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3RCLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDO0FBRVcsaUJBQVMsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFhLFdBQVcsRUFBRSx1QkFBZSxDQUFDLENBQUM7QUFDckUsb0JBQVksR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFnQixjQUFjLEVBQUUsMEJBQWtCLENBQUMsQ0FBQztBQUNqRixvQkFBWSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQWdCLGNBQWMsRUFBRSwwQkFBa0IsQ0FBQyxDQUFDO0FBQ2pGLG1CQUFXLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBZSxhQUFhLEVBQUUseUJBQWlCLENBQUMsQ0FBQztBQUM3RSxZQUFJLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBUSxNQUFNLEVBQUUsa0JBQVUsQ0FBQyxDQUFDIiwiZmlsZSI6InNlcnZlci9kYXRhYmFzZS9kYXRhYmFzZS5zY2hlbWEuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vLi4vdHlwaW5ncy9pbmRleC5kLnRzXCIgLz5cblxuaW1wb3J0IGV4cHJlc3MgPSByZXF1aXJlKFwiZXhwcmVzc1wiKTtcbmltcG9ydCAqIGFzIG1vbmdvb3NlIGZyb20gJ21vbmdvb3NlJztcblxuY29uc3QgYmNyeXB0ID0gcmVxdWlyZSgnYmNyeXB0Jyk7XG5jb25zdCBTQUxUX1dPUktfRkFDVE9SID0gMTA7XG5cbmltcG9ydCB7XG4gICAgSVVzZXIsIElHYW1lU3RhdHMsIElJdGVtU3RhdExpc3QsIElVbmxvY2tlZEl0ZW0sIElVbmxvY2thYmxlc1xufSBmcm9tIFwiLi4vLi4vaW50ZXJmYWNlLnNlcnZlclwiO1xuXG5leHBvcnQgY29uc3QgR2FtZVN0YXRzU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XG4gICAgV29uIDoge3R5cGUgOiBOdW1iZXIsIHJlcXVpcmVkIDogdHJ1ZX0sXG4gICAgUGxheWVkIDoge3R5cGUgOiBOdW1iZXIsIHJlcXVpcmVkIDogdHJ1ZX0sXG4gICAgYmFkZ2VzIDoge3R5cGUgOiBbU3RyaW5nXSwgcmVxdWlyZWQgOiBmYWxzZX1cbn0pO1xuXG5leHBvcnQgY29uc3QgSXRlbVN0YXRMaXN0U2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XG4gICAgU3BlZWQ6IHt0eXBlIDogTnVtYmVyLCByZXF1aXJlZCA6IHRydWV9LFxuICAgIEFjY2VsZXJhdGlvbjoge3R5cGUgOiBOdW1iZXIsIHJlcXVpcmVkIDogdHJ1ZX0sXG4gICAgU2hpZWxkUHJvdGVjdGlvbiA6IHt0eXBlIDogTnVtYmVyLCByZXF1aXJlZCA6IHRydWV9LFxuICAgIFNoaWVsZFJlY2hhcmdlUmF0ZSA6IHt0eXBlIDogTnVtYmVyLCByZXF1aXJlZCA6IHRydWV9LFxuICAgIEd1bkRhbWFnZSA6IHt0eXBlIDogTnVtYmVyLCByZXF1aXJlZCA6IHRydWV9LFxuICAgIEZpcmVSYXRlIDoge3R5cGUgOiBOdW1iZXIsIHJlcXVpcmVkIDogdHJ1ZX1cbn0pO1xuXG5leHBvcnQgY29uc3QgVW5sb2NrZWRJdGVtU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XG4gICAgTmFtZSA6IHt0eXBlIDogU3RyaW5nLCByZXF1aXJlZCA6IHRydWV9LFxuICAgIFN0YXRzIDoge3R5cGUgOiBJdGVtU3RhdExpc3RTY2hlbWEsIHJlcXVpcmVkIDogdHJ1ZX0sXG4gICAgRmlsZVBhdGggOiB7dHlwZSA6IFN0cmluZywgcmVxdWlyZWQgOiB0cnVlfSxcbiAgICBEZXNjcmlwdGlvbiA6IHt0eXBlIDogU3RyaW5nLCByZXF1aXJlZCA6IHRydWV9LFxuXG59KTtcblxuZXhwb3J0IGNvbnN0IFVubG9ja2FibGVzU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XG4gICAgQmlrZXMgOiB7dHlwZSA6IFtVbmxvY2tlZEl0ZW1TY2hlbWFdLCByZXF1aXJlZCA6IGZhbHNlfSxcbiAgICBUZXh0dXJlcyA6IHt0eXBlIDogW1VubG9ja2VkSXRlbVNjaGVtYV0sIHJlcXVpcmVkIDogZmFsc2V9LFxuICAgIEd1bnMgOiB7dHlwZSA6IFtVbmxvY2tlZEl0ZW1TY2hlbWFdLCByZXF1aXJlZCA6IGZhbHNlfVxufSk7XG5cbmV4cG9ydCBjb25zdCBVc2VyU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XG4gICAgQ3JlYXRlZEF0IDoge3R5cGUgOiBTdHJpbmcsICdkZWZhdWx0JyA6IERhdGUubm93fSxcbiAgICBVcGRhdGVkQXQgOiB7dHlwZSA6IFN0cmluZywgJ2RlZmF1bHQnIDogRGF0ZS5ub3d9LFxuICAgIFVzZXJOYW1lOiB7dHlwZSA6IFN0cmluZywgcmVxdWlyZWQgOiB0cnVlLCBpbmRleDogeyB1bmlxdWU6IHRydWUgfSB9LFxuICAgIFBhc3N3b3JkOiB7dHlwZSA6IFN0cmluZywgcmVxdWlyZWQgOiB0cnVlfSxcbiAgICBFbWFpbDoge3R5cGUgOiBTdHJpbmcsIHJlcXVpcmVkIDogdHJ1ZX0sXG4gICAgR2FtZVN0YXRzOiB7dHlwZTogR2FtZVN0YXRzU2NoZW1hLCByZXF1aXJlZDogdHJ1ZX0sXG4gICAgVW5sb2NrYWJsZXMgOiB7dHlwZTogVW5sb2NrYWJsZXNTY2hlbWEsIHJlcXVpcmVkOiB0cnVlfVxufSk7XG5cblVzZXJTY2hlbWEucHJlKCdzYXZlJywgZnVuY3Rpb24obmV4dCkge1xuICAgIGNvbnN0IHVzZXIgPSB0aGlzO1xuXG4gICAgLy8gb25seSBoYXNoIHRoZSBwYXNzd29yZCBpZiBpdCBoYXMgYmVlbiBtb2RpZmllZCAob3IgaXMgbmV3KVxuICAgIGlmICghdXNlci5pc01vZGlmaWVkKCdQYXNzd29yZCcpKSByZXR1cm4gbmV4dCgpO1xuXG4gICAgLy8gZ2VuZXJhdGUgYSBzYWx0XG4gICAgYmNyeXB0LmdlblNhbHQoU0FMVF9XT1JLX0ZBQ1RPUiwgZnVuY3Rpb24oZXJyLCBzYWx0KSB7XG4gICAgICAgIGlmIChlcnIpIHJldHVybiBuZXh0KGVycik7XG5cbiAgICAgICAgLy8gaGFzaCB0aGUgcGFzc3dvcmQgdXNpbmcgb3VyIG5ldyBzYWx0XG4gICAgICAgIGJjcnlwdC5oYXNoKHVzZXIuUGFzc3dvcmQsIHNhbHQsIGZ1bmN0aW9uKGVyciwgaGFzaCkge1xuICAgICAgICAgICAgaWYgKGVycikgcmV0dXJuIG5leHQoZXJyKTtcblxuICAgICAgICAgICAgLy8gb3ZlcnJpZGUgdGhlIGNsZWFydGV4dCBwYXNzd29yZCB3aXRoIHRoZSBoYXNoZWQgb25lXG4gICAgICAgICAgICB1c2VyLlBhc3N3b3JkID0gaGFzaDtcbiAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcblxuVXNlclNjaGVtYS5tZXRob2RzLmNvbXBhcmVQYXNzd29yZCA9IGZ1bmN0aW9uKGNhbmRpZGF0ZVBhc3N3b3JkLCBjYikge1xuICAgIGJjcnlwdC5jb21wYXJlKGNhbmRpZGF0ZVBhc3N3b3JkLCB0aGlzLlBhc3N3b3JkLCBmdW5jdGlvbihlcnIsIGlzTWF0Y2gpIHtcbiAgICAgICAgaWYgKGVycikgcmV0dXJuIGNiKGVycik7XG4gICAgICAgIGNiKG51bGwsIGlzTWF0Y2gpO1xuICAgIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IEdhbWVTdGF0cyA9IG1vbmdvb3NlLm1vZGVsPElHYW1lU3RhdHM+KCdHYW1lU3RhdHMnLCBHYW1lU3RhdHNTY2hlbWEpO1xuZXhwb3J0IGNvbnN0IEl0ZW1TdGF0TGlzdCA9IG1vbmdvb3NlLm1vZGVsPElJdGVtU3RhdExpc3Q+KCdJdGVtU3RhdExpc3QnLCBJdGVtU3RhdExpc3RTY2hlbWEpO1xuZXhwb3J0IGNvbnN0IFVubG9ja2VkSXRlbSA9IG1vbmdvb3NlLm1vZGVsPElVbmxvY2tlZEl0ZW0+KCdVbmxvY2tlZEl0ZW0nLCBVbmxvY2tlZEl0ZW1TY2hlbWEpO1xuZXhwb3J0IGNvbnN0IFVubG9ja2FibGVzID0gbW9uZ29vc2UubW9kZWw8SVVubG9ja2FibGVzPignVW5sb2NrYWJsZXMnLCBVbmxvY2thYmxlc1NjaGVtYSk7XG5leHBvcnQgY29uc3QgVXNlciA9IG1vbmdvb3NlLm1vZGVsPElVc2VyPignVXNlcicsIFVzZXJTY2hlbWEpOyJdfQ==
